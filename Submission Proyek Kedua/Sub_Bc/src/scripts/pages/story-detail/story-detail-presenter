export default class StoryDetailPresenter {
  #view;
  #model; 
  #storyId; 

  constructor({ view, model, storyId }) {
    this.#view = view;
    this.#model = model;
    this.#storyId = storyId;

    if (!this.#storyId) {
      console.error('StoryDetailPresenter: storyId is required for fetching details.');
    }
  }

 
  async fetchStoryDetail() {
    if (!this.#storyId) {
      if (typeof this.#view.displayError === 'function') {
        this.#view.displayError('Tidak dapat memuat cerita karena ID tidak ditemukan.');
      }
      return;
    }

    if (typeof this.#view.showLoading === 'function') {
      this.#view.showLoading();
    } else {
      console.error('StoryDetailPresenter: this.#view.showLoading is not a function.');
    }

    try {
      const response = await this.#model.getStoryById(this.#storyId);

      if (!response || typeof response.ok === 'undefined') {
        console.error('StoryDetailPresenter: Invalid response from API when fetching story detail:', response);
        throw new Error('Respons tidak valid dari API saat mengambil detail cerita.');
      }

      if (!response.ok) {
        console.error('StoryDetailPresenter: Failed to fetch story detail (API response not OK):', response);
        if (typeof this.#view.displayError === 'function') {
          this.#view.displayError(response.message || 'Gagal memuat detail cerita.');
        }
        return; 
      }

      if (response.story) {
        if (typeof this.#view.displayStoryDetail === 'function') {
          this.#view.displayStoryDetail(response.story);
        } else {
          console.error('StoryDetailPresenter: this.#view.displayStoryDetail is not a function.');
        }
      } else {
       
        console.error('StoryDetailPresenter: Story data missing in successful API response:', response);
        if (typeof this.#view.displayError === 'function') {
          this.#view.displayError('Data detail cerita tidak ditemukan dalam respons server.');
        }
      }

    } catch (error) { 
      console.error('StoryDetailPresenter: Unexpected error fetching story detail:', error);
      if (typeof this.#view.displayError === 'function') {
        this.#view.displayError(error.message || 'Terjadi kesalahan saat mengambil detail cerita.');
      }
    } finally {
      if (typeof this.#view.hideLoading === 'function') {
        this.#view.hideLoading();
      } else {
        console.error('StoryDetailPresenter: this.#view.hideLoading is not a function.');
      }
    }
  }
}